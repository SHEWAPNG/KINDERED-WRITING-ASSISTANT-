<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kindred | Say what you mean.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,500&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #FFF5F5;
            --accent-rose: #FF8A8A;
            --text-main: #3D2B2B;
            --glass: rgba(255, 255, 255, 0.6);
        }

        body.dark {
            --bg-main: #1A1616;
            --text-main: #F5EBEB;
            --glass: rgba(45, 38, 38, 0.7);
            background-image: 
                radial-gradient(at 0% 0%, hsla(353,20%,15%,1) 0, transparent 50%), 
                radial-gradient(at 50% 100%, hsla(353,30%,10%,1) 0, transparent 50%) !important;
        }

        body {
            background-color: var(--bg-main);
            background-image: 
                radial-gradient(at 0% 0%, hsla(353,100%,93%,1) 0, transparent 50%), 
                radial-gradient(at 50% 100%, hsla(22,100%,94%,1) 0, transparent 50%);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            transition: all 0.5s ease;
            min-height: 100vh;
        }

        h1, h2, .serif { font-family: 'Fraunces', serif; letter-spacing: -0.02em; }
        .step-hidden { display: none; }
        .fade-in { animation: fadeIn 0.6s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-lovable {
            background-color: var(--accent-rose);
            color: white;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 14px rgba(255, 138, 138, 0.3);
        }

        /* GEMINI SHIMMER EFFECT */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .shimmer-btn {
            background: linear-gradient(90deg, #FF8A8A, #ffb3b3, #FF8A8A);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite linear;
        }

        .tone-chip {
            background: white;
            border: 1px solid rgba(61, 43, 43, 0.1);
            color: #3D2B2B;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        body.dark .tone-chip { background: #2D2626; color: white; border-color: rgba(255,255,255,0.1); }
        .tone-chip.active { background-color: var(--accent-rose) !important; color: white !important; border-color: var(--accent-rose) !important; transform: scale(1.05); }

        .input-underline {
            background: transparent;
            border: none;
            border-bottom: 2px solid rgba(61, 43, 43, 0.1);
            color: var(--text-main);
        }
        
        .typing::after {
            content: '|';
            animation: blink 1s infinite;
            color: var(--accent-rose);
        }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-6">

    <header class="fixed top-0 w-full p-8 flex justify-between items-center z-50">
        <div class="text-2xl serif font-medium cursor-pointer" onclick="window.location.reload()">
            <span class="text-rose-400">‚ù§</span> Kindred
        </div>
        <button onclick="toggleTheme()" class="glass-card p-3 rounded-full hover:scale-110 transition-transform">
            <span id="theme-icon">üåô</span>
        </button>
    </header>

    <main id="app-container" class="w-full max-w-2xl relative z-10">
        
        <section id="view-home" class="text-center space-y-10 fade-in pt-12">
            <h1 class="text-5xl md:text-7xl font-medium leading-tight">
                Find the words <br><span class="italic text-rose-400">your heart</span> wants.
            </h1>
            <p class="text-lg md:text-xl opacity-70 max-w-lg mx-auto leading-relaxed">
                Turning "I don't know how to say this" into the perfect message.
            </p>
            <button onclick="navigateTo('view-flow')" class="btn-lovable px-12 py-5 rounded-full text-lg font-medium">
                Start Writing
            </button>
        </section>

        <section id="view-flow" class="step-hidden space-y-12">
            <div class="glass-card p-10 rounded-[2.5rem] shadow-xl">
                <div id="step-1" class="space-y-6">
                    <h2 class="text-3xl serif">What are you writing?</h2>
                    <input type="text" id="input-what" placeholder="e.g. A text to my neighbor" class="w-full input-underline py-4 text-2xl outline-none">
                    <div class="flex justify-end"><button onclick="nextStep(2)" class="text-rose-400 font-bold">Next ‚Üí</button></div>
                </div>

                <div id="step-2" class="step-hidden space-y-6">
                    <h2 class="text-3xl serif">Who is receiving this?</h2>
                    <input type="text" id="input-who" placeholder="e.g. My landlord..." class="w-full input-underline py-4 text-2xl outline-none">
                    <div class="flex justify-between"><button onclick="prevStep(1)">‚Üê Back</button><button onclick="nextStep(3)" class="text-rose-400 font-bold">Next ‚Üí</button></div>
                </div>

                <div id="step-3" class="step-hidden space-y-6">
                    <h2 class="text-3xl serif">What's on your mind?</h2>
                    <textarea id="input-intent" rows="4" placeholder="Messy thoughts..." class="w-full input-underline py-4 text-xl resize-none outline-none"></textarea>
                    <div class="flex justify-between"><button onclick="prevStep(2)">‚Üê Back</button><button onclick="nextStep(4)" class="text-rose-400 font-bold">Next ‚Üí</button></div>
                </div>

                <div id="step-4" class="step-hidden space-y-8 text-center">
                    <h2 class="text-3xl serif">How should it sound?</h2>
                    <div class="flex flex-wrap justify-center gap-3">
                        <button onclick="selectTone('Professional and formal')" class="tone-chip px-6 py-3 rounded-full text-sm">Professional</button>
                        <button onclick="selectTone('Friendly and casual')" class="tone-chip px-6 py-3 rounded-full text-sm">Friendly</button>
                        <button onclick="selectTone('Bold and persuasive')" class="tone-chip px-6 py-3 rounded-full text-sm">Persuasive</button>
                        <button onclick="selectTone('Creative and witty')" class="tone-chip px-6 py-3 rounded-full text-sm">Creative</button>
                        <button onclick="selectTone('Academic and detailed')" class="tone-chip px-6 py-3 rounded-full text-sm">Academic</button>
                        <button onclick="selectTone('Empathetic and kind')" class="tone-chip px-6 py-3 rounded-full text-sm">Empathetic</button>
                    </div>
                    <input type="hidden" id="input-tone" value="Professional and formal">
                    <button id="generate-btn" onclick="generateWriting()" class="btn-lovable text-white px-12 py-5 rounded-full text-lg font-bold w-full">
                        Help me find the words
                    </button>
                </div>
            </div>
        </section>

        <section id="view-result" class="step-hidden space-y-8">
            <div class="glass-card p-10 rounded-[2.5rem]">
                <div class="flex justify-between items-center mb-6">
                    <span id="word-count-badge" class="text-[10px] uppercase tracking-widest bg-stone-100 dark:bg-stone-800 px-3 py-1.5 rounded-full font-bold">0 Words</span>
                </div>
                <div id="output-text" class="text-xl leading-relaxed serif min-h-[150px] whitespace-pre-wrap"></div>
                <div class="mt-10 pt-8 border-t border-rose-200/10 flex gap-4 items-center">
                    <button onclick="copyToClipboard()" id="copy-btn" class="btn-lovable flex-1 px-8 py-4 rounded-full font-bold">Copy Text</button>
                    <button onclick="generateWriting()" id="regen-btn" class="bg-white dark:bg-stone-800 border border-stone-200 dark:border-stone-700 px-6 py-4 rounded-full text-sm font-bold">Try Again ‚Üª</button>
                    <button onclick="navigateTo('view-flow')" class="text-sm opacity-50">New Draft</button>
                </div>
            </div>
        </section>

    </main>

    <script>
    const API_URL = "/api/generate";
    let currentStep = 1;

    function toggleTheme() {
        document.body.classList.toggle('dark');
        const isDark = document.body.classList.contains('dark');
        document.getElementById('theme-icon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        localStorage.setItem('kindred-theme', isDark ? 'dark' : 'light');
    }

    if (localStorage.getItem('kindred-theme') === 'dark') {
        document.body.classList.add('dark');
        document.getElementById('theme-icon').textContent = '‚òÄÔ∏è';
    }

    function navigateTo(viewId) {
        document.querySelectorAll('main > section').forEach(s => s.classList.add('step-hidden'));
        document.getElementById(viewId).classList.remove('step-hidden');
    }

    function nextStep(step) {
        document.getElementById(`step-${currentStep}`).classList.add('step-hidden');
        document.getElementById(`step-${step}`).classList.remove('step-hidden');
        currentStep = step;
    }

    function prevStep(step) {
        document.getElementById(`step-${currentStep}`).classList.add('step-hidden');
        document.getElementById(`step-${step}`).classList.remove('step-hidden');
        currentStep = step;
    }

    function selectTone(tone) {
        document.getElementById('input-tone').value = tone;
        document.querySelectorAll('.tone-chip').forEach(btn => {
            btn.classList.toggle('active', tone.startsWith(btn.textContent));
        });
    }
    
    selectTone('Professional and formal');

    function typeWriter(text, elementId, speed = 15) {
        const element = document.getElementById(elementId);
        element.textContent = "";
        element.classList.add('typing');
        let i = 0;
        
        function type() {
            if (i < text.length) {
                element.textContent += text.charAt(i);
                i++;
                const count = element.textContent.trim() ? element.textContent.trim().split(/\s+/).length : 0;
                document.getElementById('word-count-badge').textContent = `${count} Words`;
                setTimeout(type, speed);
            } else {
                element.classList.remove('typing');
            }
        }
        type();
    }

    async function generateWriting() {
        const btn = document.getElementById('generate-btn');
        const outputDiv = document.getElementById('output-text');
        
        const inputs = {
            what: document.getElementById('input-what').value,
            who: document.getElementById('input-who').value,
            intent: document.getElementById('input-intent').value,
            tone: document.getElementById('input-tone').value
        };

        btn.disabled = true;
        btn.classList.add('shimmer-btn');
        btn.innerHTML = "Finding the words...";

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    userQuery: `Task: ${inputs.what} to ${inputs.who}. Context: ${inputs.intent}`, 
                    systemPrompt: `You are Kindred. Write in a ${inputs.tone} tone. Be direct and helpful.` 
                })
            });
            const data = await res.json();
            navigateTo('view-result');
            typeWriter(data.text.trim(), 'output-text');
        } catch (err) {
            alert("Error.");
        } finally {
            btn.disabled = false;
            btn.classList.remove('shimmer-btn');
            btn.innerHTML = "Help me find the words";
        }
    }

    function copyToClipboard() {
        navigator.clipboard.writeText(document.getElementById('output-text').textContent).then(() => {
            const btn = document.getElementById('copy-btn');
            btn.textContent = "Saved! ‚ú®";
            setTimeout(() => btn.textContent = "Copy Text", 2000);
        });
    }
    </script>
</body>
</html>
